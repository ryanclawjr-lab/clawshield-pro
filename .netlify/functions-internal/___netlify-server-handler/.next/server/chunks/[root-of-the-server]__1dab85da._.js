module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},66680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},60873,e=>{"use strict";let t,r,n;var a=e.i(66680);function i(e,t,r){let n=Math.floor((r??Date.now())/(1e3*t)),a=s(e,n),i=s(e,n-1);return{seed:a,expiresAt:new Date((n+1)*t*1e3).toISOString(),previousSeed:i}}function s(e,t){return(0,a.createHmac)("sha256",e).update(`fishnet-auth:seed:${t}`).digest("hex").slice(0,12)}let o=["quantum","nebula","prism","velvet","cascade","ember","fractal","horizon","lattice","mosaic","oracle","pulse","ripple","sigma","tensor","vortex","apex","bloom","cipher","drift","flux","glyph","helix","ionic","jade","knot","lumen","matrix","nova","onyx","pyre","quasar","reef","shard","tide","umbra","vivid","warp","xenon","zephyr","abyss","bolt","crest","dune","echo","forge","gleam","haze","iota","jolt","karma","lunar","myth","nexus","opal","plume"],l="abcdefghijklmnopqrstuvwxyz";function c(e,t,r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"){let n="";for(let a=0;a<t;a++)n+=r[e.int(0,r.length)];return n}function u(e,t){let r=[],n=[...o];for(let a=0;a<t&&n.length>0;a++){let t=e.int(0,n.length);r.push(n[t]),n.splice(t,1)}return r}let d={easy:["easy"],standard:["easy","standard"],hard:["easy","standard","hard"]};function p(e,t){if(!t)return e;let r=new Set(d[t]);return e.filter(e=>r.has(e.difficulty))}let h=[{type:"reverse",difficulty:"easy",generate(e){let t=c(e,e.int(8,16));return{type:"reverse",instruction:"Reverse this string exactly.",input:t,answer:t.split("").reverse().join("")}},verify:(e,t)=>t===e.answer},{type:"nthWord",difficulty:"standard",generate(e){let t=e.int(8,15),r=u(e,t),n=e.int(1,t+1);return{type:"nthWord",instruction:`What is word number ${n} in this list? (1-indexed)`,input:r,answer:r[n-1]}},verify:(e,t)=>t.trim().toLowerCase()===e.answer.toLowerCase()},{type:"jsonBuild",difficulty:"standard",generate(e){let t=u(e,e.int(4,7)),r={};for(let e of t)r[e]=e.length;let n={};for(let e of Object.keys(r).sort())n[e]=r[e];return{type:"jsonBuild",instruction:"Create a JSON object where each word is a key and its value is the word's character count. Sort keys alphabetically. Return compact JSON (no spaces).",input:t,answer:JSON.stringify(n)}},verify(e,t){try{let r=JSON.parse(t.trim()),n=JSON.parse(e.answer);return JSON.stringify(r)===JSON.stringify(n)}catch{return!1}}},{type:"arraySort",difficulty:"easy",generate(e){let t=u(e,e.int(6,12)),r=e.shuffle(t),n=[...r].sort();return{type:"arraySort",instruction:"Sort these strings alphabetically and return them comma-separated with no spaces.",input:r,answer:n.join(",")}},verify:(e,t)=>t.trim().replace(/\s/g,"")===e.answer},{type:"caesarShift",difficulty:"standard",generate(e){let t=c(e,e.int(6,12),l),r=e.int(1,26),n=t.split("").map(e=>String.fromCharCode((e.charCodeAt(0)-97+r)%26+97)).join("");return{type:"caesarShift",instruction:`Shift each letter in the string forward by ${r} position(s) in the alphabet, wrapping z back to a. Return the resulting string.`,input:t,answer:n}},verify:(e,t)=>t.trim().toLowerCase()===e.answer},{type:"pattern",difficulty:"easy",generate(e){let t=e.int(2,5),r=[];for(let n=0;n<t;n++)r.push(l[e.int(0,l.length)]);let n=[];for(let e=0;e<3;e++)for(let e of r)n.push(e);let a=r.join(",");return{type:"pattern",instruction:`This sequence repeats a pattern. What are the next ${t} elements? Return comma-separated, no spaces.`,input:n.join(","),answer:a}},verify:(e,t)=>t.trim().replace(/\s/g,"")===e.answer},{type:"transform",difficulty:"standard",generate(e){let t=c(e,e.int(6,10),l),r=[],n=t,a=e.shuffle([{name:"uppercase",apply:e=>e.toUpperCase(),desc:"Convert to uppercase"},{name:"reverse",apply:e=>e.split("").reverse().join(""),desc:"Reverse the string"},{name:"remove_vowels",apply:e=>e.replace(/[aeiouAEIOU]/g,""),desc:"Remove all vowels"},{name:"double",apply:e=>e+e,desc:"Concatenate the string with itself"},{name:"first_half",apply:e=>e.slice(0,Math.ceil(e.length/2)),desc:"Take only the first half (round up)"}]),i=e.int(2,4);for(let e=0;e<i;e++){let t=a[e];r.push(t.desc),n=t.apply(n)}return{type:"transform",instruction:`Start with the string below. Apply these steps in order:
${r.map((e,t)=>`${t+1}. ${e}`).join("\n")}
Return the final result.`,input:t,answer:n}},verify:(e,t)=>t.trim()===e.answer},{type:"firstLetters",difficulty:"easy",generate(e){let t=u(e,e.int(8,15)),r=t.map(e=>e[0]).join("");return{type:"firstLetters",instruction:"Take the first letter of each word and concatenate them into a single string.",input:t,answer:r}},verify:(e,t)=>t.trim().toLowerCase()===e.answer.toLowerCase()},{type:"wordLengths",difficulty:"standard",generate(e){let t=u(e,e.int(6,12)),r=t.map(e=>String(e.length)).join(",");return{type:"wordLengths",instruction:"Return the character count of each word as comma-separated numbers, no spaces.",input:t,answer:r}},verify:(e,t)=>t.trim().replace(/\s/g,"")===e.answer},{type:"filterWords",difficulty:"standard",generate(e){let t=u(e,e.int(10,18)),r=e.int(3,6),n=t.filter(e=>e.length>r).sort();for(;0===n.length&&r>1;)r--,n=t.filter(e=>e.length>r).sort();return{type:"filterWords",instruction:`Return only the words with more than ${r} characters, sorted alphabetically, comma-separated, no spaces.`,input:t,answer:n.join(",")}},verify:(e,t)=>t.trim().replace(/\s/g,"")===e.answer},{type:"interleave",difficulty:"easy",generate(e){let t=e.int(4,8),r=c(e,t,l),n=c(e,t,l),a="";for(let e=0;e<t;e++)a+=r[e]+n[e];return{type:"interleave",instruction:"Interleave the characters of these two strings (take one from each, alternating, starting with the first string).",input:{first:r,second:n},answer:a}},verify:(e,t)=>t.trim()===e.answer}],f=new Map;for(let e of h)f.set(e.type,e);function g(e,t){return p(e?e.map(e=>f.get(e)).filter(e=>void 0!==e):h,t)}let y="standard";function m(e,t,r,n,i=5,s=y){let o=function(e,t){let r=(0,a.createHmac)("sha256",e).update(`fishnet-auth:rng:${t}`).digest().readUInt32BE(0);function n(){r|=0;let e=Math.imul((r=r+0x6d2b79f5|0)^r>>>15,1|r);return(((e=e+Math.imul(e^e>>>7,61|e)^e)^e>>>14)>>>0)/0x100000000}function i(e,t){return Math.floor(n()*(t-e))+e}return{next:n,int:i,pick:function(e){return e[i(0,e.length)]},shuffle:function(e){let t=[...e];for(let e=t.length-1;e>0;e--){let r=i(0,e+1);[t[e],t[r]]=[t[r],t[e]]}return t}}}(t,r),l=g(n,s);if(0===l.length)throw Error("No valid task types configured for the selected difficulty");let c=[];for(let e=0;e<i;e++){let e=l[o.int(0,l.length)];c.push(e.generate(o))}return c}class w{config;constructor(e){const t=e.taskCount??5,r=e.minCorrect??t;if(r<1||r>t)throw Error(`minCorrect must be between 1 and taskCount (${t}), got ${r}`);this.config={secret:e.secret,adapter:e.adapter,taskCount:t,minCorrect:r,seedRotationSeconds:e.seedRotationSeconds??300,difficulty:e.difficulty??y,credentialPrefix:e.credentials?.prefix??"ag_",credentialType:e.credentials?.type??"api-key",expiresInMs:function(e){let t=e.match(/^(\d+)([smhd])$/);if(!t)return 6048e5;let r=parseInt(t[1],10),n=t[2],a={s:1e3,m:6e4,h:36e5,d:864e5};return r*(a[n]||a.d)}(e.credentials?.expiresIn??"7d"),taskTypes:e.taskTypes??function(e){return p(h,e).map(e=>e.type)}(e.difficulty??y),onVerified:e.onVerified,onFailed:e.onFailed}}getDiscovery(e){let t=i(this.config.secret,this.config.seedRotationSeconds),r={version:"0.1",seed:t.seed,seedExpiresAt:t.expiresAt,taskTypes:this.config.taskTypes,taskCount:this.config.taskCount,minCorrect:this.config.minCorrect,authEndpoint:"/api/agent-auth",tasks:[]};return e&&(r.tasks=m(this.config.secret,t.seed,e,this.config.taskTypes,this.config.taskCount,this.config.difficulty).map(({type:e,instruction:t,input:r})=>({type:e,instruction:t,input:r}))),r}async authenticate(e){var t;let r,{name:n,seed:s,answers:o}=e;if(!n||"string"!=typeof n||n.length<1||n.length>64)return{success:!1,error:{error:"invalid_name",message:"Agent name must be 1-64 characters."}};if(!function(e,t,r,n){let{seed:a,previousSeed:s}=i(e,t,void 0);return r===a||r===s}(this.config.secret,this.config.seedRotationSeconds,s))return{success:!1,error:{error:"invalid_seed",message:"Seed is expired or invalid."}};if(await this.config.adapter.hasCompletedAuth(s,n))return{success:!1,error:{error:"replay_detected",message:"This seed has already been used for this agent name."}};let l=function(e,t,r,n,a,i=5,s,o=y){let l=m(e,t,r,a,i,o),c=s??l.length;if(n.length!==l.length)return{valid:!1,expected:l.length,correct:0,minCorrect:c};let u=new Map(g(a,o).map(e=>[e.type,e])),d=0;for(let e=0;e<l.length;e++){let t=l[e],r=u.get(t.type);r&&r.verify(t,n[e])&&d++}return{valid:d>=c,expected:l.length,correct:d,minCorrect:c}}(this.config.secret,s,n,o,this.config.taskTypes,this.config.taskCount,this.config.minCorrect,this.config.difficulty);if(!l.valid)return await this.config.onFailed?.({name:n,reason:`Got ${l.correct}/${l.expected} correct (need ${l.minCorrect})`}),{success:!1,error:{error:"challenge_failed",message:`Incorrect answers. Got ${l.correct}/${l.expected} correct (need ${l.minCorrect}).`}};await this.config.adapter.markAuthCompleted(s,n);let c=`ag_${(0,a.randomUUID)().replace(/-/g,"").slice(0,16)}`,u=(t=this.config.credentialPrefix,r=(0,a.randomUUID)().replace(/-/g,"")+(0,a.randomUUID)().replace(/-/g,""),`${t}${r.slice(0,40)}`),d=new Date,p=new Date(d.getTime()+this.config.expiresInMs),h={id:c,name:n,apiKey:u,createdAt:d.toISOString(),expiresAt:p.toISOString()};return await this.config.adapter.createAgent(h),await this.config.onVerified?.({name:n,id:c}),{success:!0,data:{agentId:c,apiKey:u,expiresAt:p.toISOString()}}}async validateToken(e){if(!e)return null;let t=await this.config.adapter.getAgentByKey(e);return!t||new Date(t.expiresAt)<new Date?null:t}extractToken(e){if(!e)return null;let t=e.match(/^Bearer\s+(.+)$/i);return t?t[1]:null}}function v(e){let t=new w(e);return{handleDiscovery:async function(e){let r=new URL(e.url).searchParams.get("name")??void 0;return new Response(JSON.stringify(t.getDiscovery(r)),{status:200,headers:{"Content-Type":"application/json","Cache-Control":"public, max-age=60"}})},handleAuth:async function(e){let r;if("POST"!==e.method)return new Response(JSON.stringify({error:"method_not_allowed",message:"Use POST"}),{status:405,headers:{"Content-Type":"application/json"}});try{r=await e.json()}catch{return new Response(JSON.stringify({error:"invalid_body",message:"Request body must be valid JSON."}),{status:400,headers:{"Content-Type":"application/json"}})}if(!r.name||!r.seed||!Array.isArray(r.answers))return new Response(JSON.stringify({error:"missing_fields",message:"Request must include name, seed, and answers[]."}),{status:400,headers:{"Content-Type":"application/json"}});let n=await t.authenticate(r);return n.success?new Response(JSON.stringify(n.data),{status:200,headers:{"Content-Type":"application/json"}}):new Response(JSON.stringify(n.error),{status:401,headers:{"Content-Type":"application/json"}})},handleProtect:async function(e){let r=e.headers.get("Authorization"),n=t.extractToken(r);return n?await t.validateToken(n)?null:new Response(JSON.stringify({error:"unauthorized",message:"Invalid or expired token."}),{status:401,headers:{"Content-Type":"application/json"}}):new Response(JSON.stringify({error:"unauthorized",message:"Missing or invalid Authorization header."}),{status:401,headers:{"Content-Type":"application/json"}})},engine:t}}let x=process.env.FISHNET_AUTH_SECRET;if(!x)throw Error("FISHNET_AUTH_SECRET environment variable is required. Copy .env.example to .env.local and set a value.");let R={secret:x,adapter:(t=new Map,r=new Map,n=new Set,{async createAgent(e){t.set(e.apiKey,e),r.set(e.id,e)},getAgentByKey:async e=>t.get(e)??null,async revokeAgent(e){let n=r.get(e);n&&(t.delete(n.apiKey),r.delete(e))},hasCompletedAuth:async(e,t)=>n.has(`${e}:${t}`),async markAuthCompleted(e,t){n.add(`${e}:${t}`)}}),difficulty:"easy",taskCount:2,minCorrect:2,credentials:{type:"api-key",prefix:"agent_",expiresIn:"1d"}},{GET:C,POST:S,engine:T}=function(e){let{handleDiscovery:t,handleAuth:r,engine:n}=v(e);return{GET:t,POST:r,engine:n}}(R),k=function(e){let{engine:t}=v(e);return async function(e){let r=t.extractToken(e.headers.get("Authorization"));return r?t.validateToken(r):null}}({secret:R.secret,adapter:R.adapter});e.s(["GET",0,C,"POST",0,S,"engine",0,T,"getAgent",0,k],60873)},41852,e=>{"use strict";var t=e.i(47909),r=e.i(74017),n=e.i(96250),a=e.i(59756),i=e.i(61916),s=e.i(74677),o=e.i(69741),l=e.i(16795),c=e.i(87718),u=e.i(95169),d=e.i(47587),p=e.i(66012),h=e.i(70101),f=e.i(26937),g=e.i(10372),y=e.i(93695);e.i(52474);var m=e.i(220),w=e.i(60873);e.s([],68819),e.i(68819),e.s(["GET",()=>w.GET,"POST",()=>w.POST],44440);var v=e.i(44440);let x=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/agent-auth/[[...fishnet-auth]]/route",pathname:"/api/agent-auth/[[...fishnet-auth]]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/agent-auth/[[...fishnet-auth]]/route.ts",nextConfigOutput:"standalone",userland:v}),{workAsyncStorage:R,workUnitAsyncStorage:C,serverHooks:S}=x;function T(){return(0,n.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:C})}async function k(e,t,n){x.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/agent-auth/[[...fishnet-auth]]/route";w=w.replace(/\/index$/,"")||"/";let v=await x.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:R,params:C,nextConfig:S,parsedUrl:T,isDraftMode:k,prerenderManifest:A,routerServerContext:E,isOnDemandRevalidate:b,revalidateOnlyGenerated:O,resolvedPathname:N,clientReferenceManifest:j,serverActionsManifest:_}=v,I=(0,o.normalizeAppPath)(w),$=!!(A.dynamicRoutes[I]||A.routes[N]),P=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,T,!1):t.end("This page could not be found"),null);if($&&!k){let e=!!A.routes[N],t=A.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await P();throw new y.NoFallbackError}}let U=null;!$||x.isDev||k||(U="/index"===(U=N)?"/":U);let q=!0===x.isDev||!$,D=$&&!q;_&&j&&(0,s.setManifestsSingleton)({page:w,clientReferenceManifest:j,serverActionsManifest:_});let M=e.method||"GET",H=(0,i.getTracer)(),J=H.getActiveScopeSpan(),L={params:C,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:q,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,a)=>x.onRequestError(e,t,n,a,E)},sharedContext:{buildId:R}},F=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),z=c.NextRequestAdapter.fromNodeNextRequest(F,(0,c.signalFromNodeResponse)(t));try{let s=async e=>x.handle(z,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${M} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${w}`)}),o=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var i,l;let c=async({previousCacheEntry:r})=>{try{if(!o&&b&&O&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(a);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let c=L.renderOpts.collectedTags;if(!$)return await (0,p.sendResponse)(F,K,i,L.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(i.headers);c&&(t[g.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,n=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:b})},!1,E),t}},u=await x.handleResponse({req:e,nextConfig:S,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:b,revalidateOnlyGenerated:O,responseGenerator:c,waitUntil:n.waitUntil,isMinimalMode:o});if(!$)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",b?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),k&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&$||y.delete(g.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(F,K,new Response(u.value.body,{headers:y,status:u.value.status||200})),null};J?await l(J):await H.withPropagatedContext(e.headers,()=>H.trace(u.BaseServerSpan.handleRequest,{spanName:`${M} ${w}`,kind:i.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},l))}catch(t){if(t instanceof y.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:b})},!1,E),$)throw t;return await (0,p.sendResponse)(F,K,new Response(null,{status:500})),null}}e.s(["handler",()=>k,"patchFetch",()=>T,"routeModule",()=>x,"serverHooks",()=>S,"workAsyncStorage",()=>R,"workUnitAsyncStorage",()=>C],41852)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__1dab85da._.js.map